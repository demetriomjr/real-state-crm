# Fase 1 (MVP) — CRM Imobiliário SaaS

Resumo: Primeiro incremento funcional focado em captação e condução de leads até o agendamento, com comunicação centralizada e feedback claro na interface. Alinhado ao contexto: SaaS multi-tenant, React/Node.js, mobile-first, Material Design (MUI Free).

## Objetivos de Negócio
- Acelerar o tempo entre cadastro e primeiro contato com o lead.
- Manter o corretor sempre no contexto (histórico e próximos passos).
- Aumentar taxa de agendamentos originados via WhatsApp.

## Escopo do MVP (Fase 1)
Prioridade P0 (obrigatório):
- Autenticação e cadastro rápidos (e-mail/senha) com fluxo de onboarding leve.
- Multi-tenant básico: segregação por organização (tenantId) em todas as entidades.
- Cadastro e gestão de leads (criar, listar, atualizar status, notas).
- Integração WhatsApp (envio/recebimento via provedor API) com timeline por lead.
- Análise de mensagens com IA: resumo e próximos passos sugeridos.
- Integração Google Calendar: criar/atualizar evento de atendimento/visita.
- Feedbacks de UI consistentes (sucesso/erro/loading/redirecionamento).
- Auditoria e logging: createdAt/updatedAt/createdBy/updatedBy/tenantId + trilhas mínimas.

Prioridade P1 (se couber):
- Tags e origem de lead (portal, site, indicação).
- Campos customizáveis por tenant (mínimo viável, ex.: um campo extra).

Fora de escopo nesta fase: funil completo de oportunidades, gestão de imóveis e contratos, automações complexas e relatórios avançados.

## Fluxos Principais
1) Onboarding rápido
   - Criar conta (ou entrar) → criar/selecionar organização → primeiro tenant inicializado.
   - Checklist inicial: conectar WhatsApp (se aplicável), conectar Google Calendar.

2) Captação e qualificação de lead
   - Criar lead (nome, contato, interesse, origem opcional) → status inicial “Novo”.
   - Interface mobile-first com campos essenciais e validação clara.
   - Status do lead (P0): “Novo” → “Em contato” → “Agendado” → “Arquivado” (CTAs por etapa em `Colaterals.md`).

3) Conversa via WhatsApp com contexto
   - Abrir lead → enviar mensagem via WhatsApp → registrar entrada/saída automaticamente.
   - IA gera resumo curto da conversa e “próxima ação sugerida”.

4) Agendamento
   - A partir do lead, criar evento no Google Calendar (título, descrição, participantes) → retornar link e exibir no lead.

5) Feedbacks e auditoria
   - Toasts/snackbars para sucesso/erro; skeletons/spinners para carregamento.
   - Feedback em até 1s (estado de carregamento ou confirmação visual) e mensagens de erro com próximo passo.
   - Empty states com CTA principal; confirmação para ações sensíveis (arquivar/restaurar/cancelar); “Desfazer” quando seguro.
   - Logging mínimo por ação crítica, com correlação por tenant e lead.

## Requisitos Não Funcionais
- Multi-tenant: toda entidade persiste tenantId; filtros por tenant em queries por padrão.
- Mobile-first: layout responsivo, MUI (Free) como base de UI.
- Segurança: hash de senha (ex.: bcrypt), JWT por sessão curta; CORS e rate limiting no backend.
- Observabilidade: logs estruturados (níveis info/warn/error) e IDs de correlação.
- Privacidade: evitar exposição de PII em logs; mascarar quando necessário.

## Integrações
- WhatsApp Business Cloud API (Meta): https://developers.facebook.com/docs/whatsapp/cloud-api/
  - Envio/recebimento via webhooks e endpoints HTTP; armazenar IDs de mensagem por lead.
- Google Calendar API: https://developers.google.com/calendar/api
  - OAuth 2.0 por usuário; criar/atualizar eventos e ler metadados essenciais.
- IA (provedor plugável, a definir): abstrair via interface HTTP; entrada: histórico de mensagens; saída: resumo e próximos passos.

## Estrutura de Dados (resumo)
Detalhamento completo (campos, índices, critérios, ciclos de vida) em `Entities.md`. Panorama rápido em `Structure.md`.
Resumo desta fase:
- Entidades P0: Tenant, User, Lead, Message, Appointment.
- Auditoria padrão em todas as entidades (created/updated by/at + tenantId).
- Multi-tenant por tenantId e filtros padrão por tenant.

## Critérios de Aceite (recorte P0)
- Autenticação: usuário consegue criar conta e acessar em < 1 min; erros exibidos de forma amigável.
- Multi-tenant: usuário não visualiza dados de outro tenant (validação por testes de API).
- Leads: criar/editar/listar com status e notas; filtros básicos por status.
- Leads (arquivamento): arquivar remove da lista padrão, preserva histórico e pode ser restaurado; item claramente sinalizado.
- WhatsApp: enviar mensagem teste e registrar no histórico do lead; receber via webhook e associar corretamente.
- IA: ao abrir histórico, ver “Resumo” e “Próxima ação sugerida” gerados em < 3s (com fallback se indisponível).
- Calendar: criar evento e ver link/horário refletidos no lead.
- Calendar (cancelamento): cancelamentos são preservados e identificados; listas padrão ocultam cancelados.
- Feedbacks: toasts para operações; loaders visíveis em chamadas remotas; feedback em até 1s e mensagens de erro com próximo passo; empty states com CTA.
- Histórico: nenhuma ação do usuário apaga histórico inadvertidamente (sem exclusões em cadeia; ver regras em `Colaterals.md`).

## Métricas de Sucesso (Fase 1)
- Tempo até primeiro contato (cadastro → primeira mensagem) — meta: < 10 min.
- % de leads com próximo passo definido — meta: ≥ 80%.
- % de leads que viram agendamento — meta: ≥ 20% no MVP.
- Latência IA visível — meta p50 < 3s com fallback.
- Engajamento em CTAs de “próximo passo” — acompanhar cliques e conversão entre etapas.

## Riscos e Mitigações
- Dependência de provedores (WhatsApp/Calendar): usar camadas de abstração e chaves por tenant.
- Custos/limites de API: monitorar uso e aplicar backoff; cache leve para metadados.
- Privacidade e LGPD: coletar consentimento e permitir arquivamento/remoção de dados sob solicitação.

## Roadmap de Entrega (proposta enxuta)
1. Semana 1: Autenticação + multi-tenant básico + modelo de dados + UI base (MUI).
2. Semana 2: Leads CRUD + Feedbacks de UI + auditoria/logging.
3. Semana 3: WhatsApp (envio + webhook básico) + timeline por lead.
4. Semana 4: IA (resumo + próxima ação) + Google Calendar (criar evento).
5. Semana 5: Endurecimento (testes, métricas, segurança) + polimento mobile-first.

## Referências internas
- Funcionalidades (prioridades e critérios): `Functionalities.md`
- Entidades e relações (P0/P1): `Entities.md`
 - Parâmetros de contexto (leituras obrigatórias): `parameter-context.md`
 - Sumário (árvore de documentação): `SUMÁRIO.md`
 - Stakeholders (objetivos, responsabilidades, métricas): `Stakeholders.md`
 - Ações colaterais (regras P0/P1): `Colaterals.md`

## Política de Documentação e Contexto
- Antes de qualquer novo trabalho de agente, ler e seguir `parameter-context.md`.
- Atualizações em arquivos principais devem re-trabalhar o conteúdo por inteiro quando necessário (evitar apenas anexos no final).
- Manter textos curtos, coesos, práticos e sem contradições, priorizando o objetivo geral do MVP.
- Ao editar uma sub-file (children), atualizar a main file correspondente (esta) com o delta relevante.
